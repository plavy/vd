<!doctype html>

<html>

<head>
    <title>Graph</title>
    <script src="dagre.min.js"></script>
    <script src="cytoscape.min.js"></script>
    <script src="cytoscape-dagre.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

    <script src="datasets.js"></script>

</head>

<style>
    #cy {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0%;
        left: 0%;
        background-color: whitesmoke;
    }

    #control-bar {
        position: fixed;
        bottom: 0;
        margin-bottom: 10px;
        z-index: 9;
    }

    #right-panel {
        position: absolute;
        top: 0%;
        left: 80%;
        width: 20%;
        height: 100%;
        z-index: 10;
    }
</style>

<body>
    <div id="right-panel">
        <canvas id="histogram" style="width:100%;max-width:600px"></canvas>
    </div>

    <div id="control-bar">
        <button id="color-A" type="button">Change color of A nodes</button>
        <button id="select-A" type="button">Select A nodes</button>
        <button id="reset-zoom" type="button">Zoom to fit</button>

        <label for="dataset-select">Dataset</label>
        <select name="datasets" id="select-dataset">
        </select>
    </div>

    <div id="cy"></div>

    <script>
        const K = 3

        // Initialize dataset list
        selectDataset = document.getElementById('select-dataset');
        for (var i = 0; i < datasets.length; i++) {
            var opt = document.createElement('option');
            opt.value = i;
            opt.innerHTML = datasets[i].name;
            selectDataset.appendChild(opt);
        }

        var cy = cytoscape({
            container: document.getElementById('cy'),
            elements: datasets[0], // from datasets.js
            style: [
                {
                    selector: 'node',
                    style: {
                        shape: 'ellipse',
                        label: 'data(id)',
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'line-color': '#ccc',
                        'target-arrow-color': '#ccc',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier'
                    }
                },
                {
                    selector: ':selected',
                    css: {
                        'background-color': 'white',
                        'line-color': 'black',
                        'target-arrow-color': 'black'
                    }
                }],
            wheelSensitivity: 0.1
        });

        var hist = new Chart("histogram", {
            type: "bar",
            data: {
                labels: [],
                datasets: [{
                    data: []
                }]
            },
            options: {
                legend: { display: false },
                scales: {
                    yAxes: [{ ticks: { min: 0 } }],
                }
            }
        });
        document.getElementById("histogram").onclick = function (evt) {
            var points = hist.getElementsAtEventForMode(evt, 'nearest', {
                intersect: true
            }, true);
            if (points.length) {
                setSelected(points[0]._index);
            }
        };


        function changeColor(event) {
            let nodes = cy.nodes(".group0");
            nodes.forEach(function (node) {
                node.style("background-color", "blue");
            });
        }

        function resetZoom(event) {
            cy.fit();
        }

        function setSelected(index) {
            cy.nodes().unselect();
            cy.nodes(".group" + index).select();
        }

        function updateDataset(event) {
            cy.json({ elements: newEleJsons });
        }

        document.getElementById("color-A").addEventListener('click', changeColor);
        document.getElementById("select-A").addEventListener('click', (event) => setSelected("0"));
        document.getElementById("reset-zoom").addEventListener('click', resetZoom);
        document.getElementById("select-dataset").addEventListener('change', (event) => {
            cy.json({ elements: datasets[event.target.value] });
            refreshGraphs();
        })

        function refreshGraphs() {
            cy.layout({
                name: 'dagre'
            }).run();

            let count = new Array(K)
            for (var i = 0; i < K; i++) {
                count[i] = 0
                cy.nodes(".group" + i).forEach((node) => count[i] += node.neighborhood().nodes().length);
            }
            hist.data.labels = ["A", "B", "C"];
            hist.data.datasets = [{
                data: count
            }]
            hist.update();
        }






        refreshGraphs()
    </script>
</body>

</html>